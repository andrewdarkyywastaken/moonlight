if not get_comm_channel then return"1"end;local cloneref=cloneref or function(a)return a end;local b=cloneref(game:GetService("HttpService"))local c=cloneref(game:GetService("RunService"))local d=...local e,f;if d then e,f=d,get_comm_channel(d)else if not create_comm_channel then return"1"end;e,f=create_comm_channel()end;local g,h={}d=d and true or false;local i={Base={"Visible","ZIndex","Transparency","Color"},Line={"Thickness","From","To"},Text={"Text","Size","Center","Outline","OutlineColor","Position","TextBounds","Font"},Image={"Data","Size","Position","Rounding"},Circle={"Thickness","NumSides","Radius","Filled","Position"},Square={"Thickness","Size","Position","Filled"},Quad={"Thickness","PointA","PointB","PointC","PointD","Filled"},Triangle={"Thickness","PointA","PointB","PointC","Filled"}}f.Event:Connect(function(...)local j,k=...local l={select(3,...)}if d and j then if k=="new"then local m=newproxy(true)local n=getmetatable(m)local o={Changed={}}function o:Destroy()f:Fire(false,"destroy",l[2])g[l[2]]=nil end;n.__index=o;n.__newindex=function(p,q,r)rawset(o.Changed,q,r)return rawset(o,q,r)end;for s,t in l[1]do rawset(o,s,t)end;g[l[2]]=m;h[l[3]]=m elseif k=="update"then for s,t in l[1]do local a=g[s]if a then for u,v in t do rawset(a,u,v)end end end end else if k=="new"then local a=Drawing.new(l[1])local w=b:GenerateGUID():sub(1,6)local x={}for p,t in i.Base do x[t]=a[t]end;for p,t in i[l[1]]do x[t]=a[t]end;g[w]=a;f:Fire(true,"new",x,w,l[2])elseif k=="update"then for s,t in l[1]do local a=g[s]if a then for u,v in t do a[u]=v end end end elseif k=="destroy"then local a=g[l[1]]if a then pcall(function()a:Destroy()end)g[l[1]]=nil end end end end)if d and not Drawing then task.spawn(function()while true do local y,z={}for s,t in g do for u,v in t.Changed do if not y[s]then y[s]={}z=true end;rawset(y[s],u,v)end;if y[s]then table.clear(t.Changed)end end;if z then f:Fire(false,"update",y)end;c.PreRender:Wait()end end)return function(A)local B=b:GenerateGUID(true):sub(1,6)f:Fire(false,"new",A,B)repeat task.wait()until h[B]local a=h[B]h[B]=nil;return a end else return e end
