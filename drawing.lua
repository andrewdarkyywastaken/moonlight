if not get_comm_channel then return'1'end;local cloneref=cloneref or function(a)return a end;local b=cloneref(game:GetService('HttpService'))local c=cloneref(game:GetService('RunService'))local d=...local e,f;if d then e,f=d,get_comm_channel(d)else if not create_comm_channel then return'1'end;e,f=create_comm_channel()end;local g,h,i={},{}d=d and true or false;local j={Base={'Visible','ZIndex','Transparency','Color'},Line={'Thickness','From','To'},Text={'Text','Size','Center','Outline','OutlineColor','Position','TextBounds','Font'},Image={'Data','Size','Position','Rounding'},Circle={'Thickness','NumSides','Radius','Filled','Position'},Square={'Thickness','Size','Position','Filled'},Quad={'Thickness','PointA','PointB','PointC','PointD','Filled'},Triangle={'Thickness','PointA','PointB','PointC','Filled'}}f.Event:Connect(function(...)local k,l=...local m={select(3,...)}if d and k then if l=='new'then local n=newproxy(true)local o=getmetatable(n)local p={Changed={}}function p:Destroy()f:Fire(false,'destroy',m[2])g[m[2]]=nil end;o.__index=p;o.__newindex=function(q,r,s)rawset(p.Changed,r,s)return rawset(p,r,s)end;for t,u in m[1]do rawset(p,t,u)end;g[m[2]]=n;h[m[3]]=n elseif l=='update'then for t,u in m[1]do local a=g[t]if a then for v,w in u do rawset(a,v,w)end end end end else if l=='new'then local a=Drawing.new(m[1])local x=b:GenerateGUID():sub(1,6)local y={}for q,u in j.Base do y[u]=a[u]end;for q,u in j[m[1]]do y[u]=a[u]end;g[x]=a;f:Fire(true,'new',y,x,m[2])elseif l=='update'then for t,u in m[1]do local a=g[t]if a then for v,w in u do a[v]=w end end end elseif l=='destroy'then local a=g[m[1]]if a then pcall(function()a:Destroy()end)g[m[1]]=nil end end end end)if d and not Drawing then i=task.spawn(function()while true do local z,A={}for t,u in g do for v,w in u.Changed do if not z[t]then z[t]={}A=true end;rawset(z[t],v,w)end;if z[t]then table.clear(u.Changed)end end;if A then f:Fire(false,'update',z)end;c.PreRender:Wait()end end)getgenv().Drawing={new=function(B)local C=b:GenerateGUID(true):sub(1,6)f:Fire(false,'new',B,C)repeat task.wait()until h[C]local a=h[C]h[C]=nil;return a end,kill=function()task.cancel(i)for q,u in g do pcall(function()u:Destroy()end)end;table.clear(g)end}else return e end
